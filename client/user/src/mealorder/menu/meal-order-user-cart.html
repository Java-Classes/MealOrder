<!--
  ~ Copyright 2018, TeamDev Ltd. All rights reserved.
  ~
  ~ Redistribution and use in source and/or binary forms, with or without
  ~ modification, must retain the above copyright notice and the following
  ~ disclaimer.
  ~
  ~ THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  ~ "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  ~ LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  ~ A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
  ~ OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  ~ SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  ~ LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  ~ DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  ~ THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  ~ (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  ~ OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  -->
<script src="../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="meal-order-user-order.html">

<dom-module id="meal-order-user-cart">
    <template>
        <style>
            #cart {
                overflow-x: hidden;
                overflow-y: auto;
                max-height: 93vh;
            }
            #total {
                display: flex;
                justify-content: space-between;
                margin: 6% 4% 10% 4%;
                font-weight: bolder;
            }
        </style>
        <div id="cart">
            <dom-repeat items="[[order]]" as="dish">
                <template>
                    <meal-order-user-order order="[[dish]]"></meal-order-user-order>
                </template>
            </dom-repeat>
            <dom-if if="[[order.length]]">
                <template>
                    <div id="total">
                        <div class="amount">Общая сумма:</div>
                        <div class="price">[[total]] ₴</div>
                    </div>
                </template>
            </dom-if>
        </div>
    </template>
    <script>
        /**
         * user-cart is user's order for current date.
         *
         * @customElement
         * @polymer
         */
        class MealOrderUserCart extends Polymer.Element {
            static get is() {
                return 'meal-order-user-cart';
            }

            static get properties() {
                return {
                    /**
                     * Fired on dish remove button tap.
                     *
                     * @event `dish-removed`
                     * @param {dish} contains vendor, title.
                     */

                    /**
                     * Fired when a dish add button is tapped.
                     *
                     * @event `order-removed`
                     * @param {order} contains vendor.
                     */

                    /**
                     * Array to be displayed in a user cart.
                     */
                    order: {
                        type: Array,
                    },
                    /**
                     * Total cost of an order for current day.
                     */
                    total: {
                        type: Number,
                        computed: '_getTotalAmount(order)'
                    }
                }
            }

            _getTotalAmount() {
                let sum = 0;
                for (let i = 0; i < this.order.length; i++) {
                    for (let j = 0; j < this.order[i].dishes.length; j++) {
                        sum += this.order[i].dishes[j].price * this.order[i].dishes[j].quantity;
                    }
                }
                return sum;
            }
        }
        window.customElements.define(MealOrderUserCart.is, MealOrderUserCart);
    </script>
</dom-module>
