<!--
  ~ Copyright 2018, TeamDev Ltd. All rights reserved.
  ~
  ~ Redistribution and use in source and/or binary forms, with or without
  ~ modification, must retain the above copyright notice and the following
  ~ disclaimer.
  ~
  ~ THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  ~ "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  ~ LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  ~ A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
  ~ OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  ~ SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  ~ LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  ~ DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  ~ THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  ~ (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  ~ OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  -->
<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/gold-phone-input/gold-phone-input.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../../bower_components/iron-form/iron-form.html">

<link rel="import" href="../shell/meal-order-admin-app-namespace.html">
<link rel="import" href="../shell/redux-store.html">

<dom-module id="admin-vendor-dialog">
    <template>
        <style>
            #dialog {
                max-height: 500px;
            }

            #dialog-content {
                display: flex;
                flex-direction: column;
                width: 50vh;
                min-width: 400px;
            }

            paper-button {
                font-family: 'Roboto', 'Noto', sans-serif;
                font-weight: normal;
                font-size: 14px;
                -webkit-font-smoothing: antialiased;
            }

            paper-dialog.size-position {
                height: 100%;
                position: fixed;
                top: 40%;
                left: 50%;
                transform: translate(-57%, -50%);
                color: var(--google-grey-700);
            }

            paper-input {
                margin-top: 5%;
                --paper-input-container-focus-color: var(--google-grey-700);
            }

            gold-phone-input {
                margin-top: 5%;
                margin-bottom: 5%;
            }

            #time {
                width: 25%;
            }

            .dialog-buttons {
                margin-top: 5%;
                display: flex;
            }

            .remove-button-wrapper {
                width: 50%;
                text-align: left;
            }

            .buttons-wrapper {
                width: 50%;
                text-align: right;
            }

            .confirm {
                background-color: var(--google-blue-500);
                color: var(--google-green-100);
            }

            @media only screen and (max-width: 1024px) {
                #dialog-content {
                    width: auto;
                }

                #dialog {
                    max-width: 450px;
                    width: 100vh;
                }

                .dialog-buttons {
                    margin-top: 10%;
                }
            }

            @media only screen and (max-width: 660px) {
                #dialog-content {
                    min-width: 0;
                }

                #dialog {
                    max-height: none;
                    max-width: none;
                }

                .dialog-buttons {
                    margin-top: 50%;
                }

                .remove-button-wrapper {
                    width: 44%;
                }

                .buttons-wrapper {
                    width: 70%;
                }

                #time {
                    width: 30%;
                }

                paper-dialog.size-position {
                    height: 100%;
                    top: 9%;
                    left: 0;
                    transform: none;
                    margin: 0;
                }

                paper-dialog {
                    max-height: 100%;
                    max-width: 100%;
                    width: 100vh;
                }
            }

            @media only screen and (max-width: 320px) {
                .dialog-buttons {
                    margin-top: 25%;
                }
            }
        </style>

        <paper-dialog class="size-position" id="dialog" with-backdrop modal>
            <div id="dialog-content">
                <iron-form id="form">
                    <form>
                        <h2 hidden="[[_isUpdate()]]">Добавить поставщика</h2>
                        <h2 hidden="[[!_isUpdate()]]">Детали поставщика</h2>
                        <paper-input value="{{inputData.title}}"
                                     error-message="Обязательное поле"
                                     label="Название" required="true"></paper-input>
                        <paper-input value="{{inputData.mail}}"
                                     label="Почта" type="email" required="true"
                                     error-message="Неверный формат почты">
                        </paper-input>
                        <gold-phone-input
                                country-code="38"
                                phone-number-pattern="xxx-xx-xx-xxx" value="{{inputData.phone}}"
                                required="true"
                                error-message="Неверный формат телефона">
                        </gold-phone-input>
                        <div id="time">
                            <paper-input label="Заказать до" type="time"
                                         value="{{inputData.deadline}}"
                                         required="true">
                                <div slot="prefix"></div>
                            </paper-input>
                        </div>
                    </form>
                    <div class="dialog-buttons">
                        <div class="remove-button-wrapper">
                            <div hidden="[[!_isUpdate()]]">
                                <paper-button on-click="_removeVendor">Удалить
                                </paper-button>
                            </div>
                        </div>
                        <div class="buttons-wrapper">
                            <paper-button on-click="_closeDialog">Отмена</paper-button>
                            <paper-button class="confirm" on-click="_confirm">
                                <div hidden="[[_isUpdate()]]">Сохранить</div>
                                <div hidden="[[!_isUpdate()]]">Обновить</div>
                            </paper-button>
                        </div>
                    </div>
                </iron-form>
            </div>
        </paper-dialog>
    </template>
    <script>
        {
            /**
             * Dialog for managing vendors.
             *
             * Can have one of following modes:
             * 1. `add` adds new vendor after validation
             * 2. `update` updates existing vendor after validation
             *
             * @customElement
             * @polymer
             * @appliesMixin MealOrderApp.ReduxMixin
             */
            class AdminVendorDialog extends MealOrderAdminApp.ReduxMixin(Polymer.Element) {
                static get is() {
                    return 'admin-vendor-dialog';
                }

                static get properties() {
                    return {
                        /**
                         * Dialog working mode.
                         *
                         * Can be `add` mode or `update`.
                         * Depending on this it sends different events and renders different elements.
                         */
                        update: {
                            type: Boolean
                        },

                        /**
                         * Values from dialog inputs.
                         *
                         * @property {title} vendor name
                         * @property {mail} vendor email
                         * @property {phone} vendor name
                         * @property {deadline} a time when a user can no more add dishes to their order
                         */
                        inputData: {
                            type: Object,
                            value: {}
                        }
                    }
                };

                static get actions() {
                    return {
                        closeDialog() {
                            return {
                                type: MealOrderAdminApp.AdminActions.CLOSE_VENDOR_DIALOG
                            }
                        },
                        addVendor(vendor) {
                            return {
                                type: MealOrderAdminApp.AdminActions.ADD_VENDOR,
                                vendor: vendor
                            }
                        },
                        updateVendor(vendor) {
                            return {
                                type: MealOrderAdminApp.AdminActions.UPDATE_VENDOR,
                                vendor: vendor
                            }
                        },
                        removeVendor: function (title) {
                            return {
                                type: MealOrderAdminApp.AdminActions.REMOVE_VENDOR,
                                title
                            }
                        }
                    }
                }

                _confirm() {
                    console.log('confirmin');
                    if (this.$.form.validate()) {
                        const vendor = {};
                        vendor.title = this.inputData.title;
                        vendor.mail = this.inputData.mail;
                        vendor.phone = this.inputData.phone;
                        vendor.deadline = this.inputData.deadline;
                        let actionName;
                        console.log(vendor);
                        this.update ? actionName = 'updateVendor' : actionName = 'addVendor';
                        this.dispatch(actionName, vendor);
                        this._closeDialog();
                    }
                }

                _removeVendor() {
                    this.dispatch("removeVendor", this.inputData.title);
                    this._closeDialog();
                }

                _closeDialog() {
                    this.$.dialog.close();
                    this.parentNode.removeChild(this);
                    this.dispatch('closeDialog');
                }

                _isUpdate() {
                    return this.update;
                }
            }

            MealOrderAdminApp.AdminVendorDialog = AdminVendorDialog;
            window.customElements.define(AdminVendorDialog.is, AdminVendorDialog);
        }
    </script>
</dom-module>
