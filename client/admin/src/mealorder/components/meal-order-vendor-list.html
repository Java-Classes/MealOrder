<!--
  ~ Copyright 2018, TeamDev Ltd. All rights reserved.
  ~
  ~ Redistribution and use in source and/or binary forms, with or without
  ~ modification, must retain the above copyright notice and the following
  ~ disclaimer.
  ~
  ~ THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  ~ "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  ~ LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  ~ A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
  ~ OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  ~ SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  ~ LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  ~ DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  ~ THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  ~ (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  ~ OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  -->
<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-fab-speed-dial/paper-fab-speed-dial.html">
<link rel="import"
      href="../../../bower_components/paper-fab-speed-dial/paper-fab-speed-dial-action.html">

<link rel="import" href="../shell/meal-order-admin-app-namespace.html">
<link rel="import" href="../shell/redux-store.html">

<dom-module id="meal-order-vendor-list">
    <template>
        <style>
            #header {
                display: flex;
                cursor: pointer;
                justify-content: space-between;
                align-items: center;
                margin: 4% auto 0 auto;
                width: 70%;
            }

            paper-item {
                width: 100%;
            }

            .item {
                @apply --layout-horizontal;
                height: 50px;
                display: flex;
                background-color: white;
                border-bottom: 1px solid #ddd;
                cursor: pointer;
                justify-content: space-between;
                align-items: center;
            }

            .item:hover .icons-container {
                display: block;
            }

            .vendor-name {
                text-align: left;
                width: 10%;
                padding-left: 2%;
            }

            .email {
                text-align: left;
                width: 20%;
            }

            .phone {
                width: 15%;
                text-align: left;
            }

            .deadline {
                width: 13%;
                text-align: right;
            }

            .icons {
                width: 10%;
            }

            .icons-container {
                display: none;
            }

            .header {
                display: flex;
                font-weight: bold;
                background-color: #f2f2f2;
                border: 1px solid #ddd;
            }

            #main-content {
                margin: 0 auto;
                width: 70%;
            }

            #fab {
                --paper-fab-speed-dial-background: #0085d3;
                --paper-fab-speed-dial-keyboard-focus-background: #0085d3;
                --paper-fab-speed-dial-position: fixed;
            }

            @media only screen and (max-width: 1300px) {
                #header {
                    width: 98%;
                }

                #main-content {
                    width: 100%;
                }
            }

            @media only screen and (max-width: 900px) {
                paper-input {
                    margin-top: 0;
                }

                h2 {
                    font-size: 16px;
                }

                #header {
                    width: 98%;
                }

                .vendor {
                    display: none;
                }

                .email {
                    text-align: left;
                    width: 25%;
                }

                .deadline {
                    width: 15%;
                    text-align: right;
                }

                .icons {
                    width: 12%;
                }

                @media only screen and (max-width: 768px) {
                    #header {
                        justify-content: flex-end;
                        width: 98%;
                        margin-bottom: 3%;
                    }

                    .vendor {
                        display: none;
                    }

                    .phone {
                        display: none;
                    }

                    .deadline {
                        display: none;
                    }

                    .icons {
                        display: none;
                    }

                    .vendor-name {
                        width: 40%;
                    }

                    .email {
                        width: 60%;
                    }

                }
            }
        </style>
        <div id="header">
            <h1 class="vendor">Поставщики</h1>
        </div>
        <div id="main-content">
            <div class="item non-select header">
                <div class="vendor-name">Название</div>
                <div class="email">Почта</div>
                <div class="phone">Телефон</div>
                <div class="deadline">Заказать до</div>
                <div class="icons"></div>
            </div>
            <iron-list selection-enabled on-selected-item-changed="_openDetailsDialog" id="list"
                       items="[[vendors]]" as="vendor" scroll-target="document"
                       scroll-offset="200">
                <template>
                    <div class="item">
                        <div class="vendor-name">[[vendor.title]]</div>
                        <div class="email">[[vendor.email]]</div>
                        <div class="phone">[[vendor.phone]]</div>
                        <div class="deadline">[[vendor.deadline]]</div>
                        <div class="icons">
                            <div class="icons-container">
                                <paper-icon-button icon="create"
                                                   on-click="_openDetailsDialog"></paper-icon-button>
                            </div>
                        </div>
                    </div>
                </template>
            </iron-list>
        </div>
        <paper-fab-speed-dial on-iron-overlay-opened="_addVendorDialog" id="fab">
        </paper-fab-speed-dial>
    </template>
    <script>
        {
            /**
             * A vendor list.
             *
             * Contains a dialog for adding and editing a vendor.
             *
             * @customElement
             * @polymer
             * @appliesMixin MealOrderApp.ReduxMixin
             */
            class MealOrderVendorList extends MealOrderAdminApp.ReduxMixin(Polymer.Element) {
                static get is() {
                    return 'meal-order-vendor-list';
                }

                static get properties() {
                    return {
                        /**
                         * A vendor list.
                         *
                         * @typedef {Object} Vendor
                         *
                         * @property {String} title a vendor name
                         * @property {String} phone a vendor phone
                         * @property {String} email a vendor email
                         * @property {String} deadline time up to which order can be made
                         *
                         */
                        vendors: {
                            type: Array,
                            statePath: 'vendors'
                        }
                    }
                };

                static get actions() {
                    return {
                        openVendorDialog: function (properties) {
                            return {
                                type: MealOrderAdminApp.AdminActions.OPEN_VENDOR_DIALOG,
                                properties
                            }
                        }
                    }
                }

                _addVendorDialog() {
                    const properties = {};
                    properties.tagName = MealOrderAdminApp.AdminVendorDialog.is;
                    properties.mode = 'add';
                    this.dispatch('openVendorDialog', properties);
                    this.$.fab.close();
                }


                _openDetailsDialog(e) {
                    const properties = {};
                    properties.tagName = MealOrderAdminApp.AdminVendorDialog.is;
                    properties.mode = 'update';
                    const inputData = {};

                    if (this.$.list.selectedItem) {
                        inputData.newTitle = this.$.list.selectedItem.title;
                        inputData.newMail = this.$.list.selectedItem.email;
                        inputData.phone = this.$.list.selectedItem.phone;
                        inputData.deadline = this.$.list.selectedItem.deadline;
                        properties.inputData = inputData;
                        this.dispatch('openVendorDialog', properties);
                    }
                    if (e.model) {
                        inputData.newTitle = this.vendors[e.model.index].title;
                        inputData.newMail = this.vendors[e.model.index].email;
                        inputData.phone = this.vendors[e.model.index].phone;
                        inputData.deadline = this.vendors[e.model.index].deadline;
                        properties.inputData = inputData;
                        this.dispatch('openVendorDialog', properties);
                    }
                }

            }

            window.customElements.define(MealOrderVendorList.is, MealOrderVendorList);
        }
    </script>
</dom-module>
